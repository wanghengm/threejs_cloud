<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
        <link type="text/css" rel="stylesheet" href="main.css" />
        <style>
            body {
                background-color: #f0f0f0;
                color: #444;
            }
            a {
                color: #08f;
            }
        </style>
    </head>
    <body>
        <div id="junying"></div>

        <script type="module">
            import * as THREE from '/build/three.module.js';
            import { CinematicCamera } from './js/jsm/cameras/CinematicCamera.js';
            import Stats from '/js/jsm/libs/stats.module.js';
            import { GUI } from '/js/jsm/libs/dat.gui.module.js';
            import { OrbitControls } from './js/jsm/controls/OrbitControls.js';
            import { TransformControls } from './js/jsm/controls/TransformControls.js';

            let junying = document.getElementById('junying');
            import { GLTFLoader } from './js/jsm/loaders/GLTFLoader.js';
            import { RGBELoader } from './js/jsm/loaders/RGBELoader.js';

            let camera, scene, renderer;

            init();
            render();

            function init() {
                const container = document.createElement('div');
                document.body.appendChild(container);

                camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.25, 20);
                camera.position.set(-1.8, 0.6, 2.7);

                scene = new THREE.Scene();

                // const loader = new GLTFLoader().setPath('../model/');
                // loader.load('man2.gltf', function (gltf) {
                //     scene.add(gltf.scene);
                //     render();
                // });
                new RGBELoader().setPath('../model/').load('pedestrian_overpass_2k.hdr', function (texture) {
                    texture.mapping = THREE.EquirectangularReflectionMapping;

                    scene.background = texture;
                    scene.environment = texture;

                    render();

                    // model

                    const loader = new GLTFLoader().setPath('../model/');
                    loader.load('man2.gltf', function (gltf) {
                        scene.add(gltf.scene);

                        render();
                    });
                });

                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.toneMapping = THREE.ACESFilmicToneMapping;
                renderer.toneMappingExposure = 1;
                renderer.outputEncoding = THREE.sRGBEncoding;
                container.appendChild(renderer.domElement);

                const controls = new OrbitControls(camera, renderer.domElement);
                controls.addEventListener('change', render); // use if there is no animation loop
                controls.minDistance = 2;
                controls.maxDistance = 1000;
                controls.target.set(0, 0, -0.2);
                controls.update();

                window.addEventListener('resize', onWindowResize);
            }

            function onWindowResize() {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();

                renderer.setSize(window.innerWidth, window.innerHeight);

                render();
            }

            //

            function render() {
                renderer.render(scene, camera);
            }
        </script>
    </body>
</html>
